<query-editor-row query-ctrl="ctrl" class="generic-datasource-query-row" has-text-edit-mode="true">
  <div class="gf-form-inline">

    <div class="gf-form" ng-if="ctrl.target.rawQuery">
      <textarea class="gf-form-input" rows="5" ng-model="ctrl.target.target" spellcheck="false" ng-blur="ctrl.onChangeInternal()" />
    </div>

    <div ng-if="!ctrl.target.rawQuery">
      <div class="gf-form right" width-64>
        <label class="gf-form-label width-5 query-keyword">Query</label>
	<input type="text" class="gf-form-input width-32" ng-model="ctrl.target.target" spellcheck='false'
          allow-custom="true"
          lookup-text="true"
          get-options="ctrl.getOptions($query)"
          on-change="ctrl.onChangeInternal()">
	</input>
	<info-popover mode="right-absolute">
        Specify a pmseries query expression. This can simply be a PCP metric name (e.g. kernel.all.load), or a full query including hostname, instance name and label patterns. See pmseries(1) and pmwebapi(3). Do not include any time-window parameters since these are automatically added by Grafana.
      </info-popover>
      </div>
    </div>

    <div class="gf-form">
      <gf-form-switch
      class="gf-form" label="Rate Convert" label-class="width-8" ng-model="ctrl.target.isCounter" checked="ctrl.target.isCounter" on-change="ctrl.refresh()">
      </gf-form-switch>
      <label class="gf-form-label width-5 legend-keyword">Legend</label>
      <input type="text" width-16 class="gf-form-input" ng-model="ctrl.target.legend" spellcheck='false'
	allow-custom="true"
	lookup-text="true"
	on-change="ctrl.refresh()"
      </input>
      <info-popover mode="right-absolute">
      Specify a legend template. If empty, this defaults to the query string. Substrings enclosed in double curly braces are interpreted as label names and will be substituted with their label value string. Grafana template variable names can also be specified (also in double curly braces) and will also be substituted with their respective value - template variable substitution occurs after label substitution.
    </info-popover>

    </div>

  </div>
</query-editor-row>
