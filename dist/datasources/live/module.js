define(["lodash","app/plugins/sdk"],function(t,e){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=130)}({0:function(t,e,n){"use strict";var r;n.d(e,"a",function(){return r}),function(t){t.TimeSeries="time_series",t.Table="table",t.Heatmap="heatmap"}(r||(r={}))},1:function(e,n){e.exports=t},10:function(t,e,n){"use strict";var r=n(1),i=n.n(r),a=n(0),o=function(){function t(t){this.templateSrv=t}return t.prototype.getLabel=function(t,e){if(i.a.isEmpty(e))return t;var n=t.split("."),r={instance:{value:t},metric0:{value:n[n.length-1]}};return this.templateSrv.replace(e,r)},t.prototype.updateLabels=function(t,e){var n=this;return t.map(function(t){return{target:n.getLabel(t.target,e.legendFormat),datapoints:t.datapoints}})},t.prototype.transformToHeatmap=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e],i=r.target.match(/^(.+?)\-(.+?)$/);i&&(r.target=i[2]),r.datapoints=r.datapoints.map(function(t){return[t[0],1e3*Math.floor(t[1]/1e3)]})}return t},t.prototype.transformToTable=function(t){var e="";t.length>0&&t[0].datapoints.length>0&&(e=t[0].datapoints[0][0]);for(var n={columns:[],rows:[],type:"table"},r=e.split("\n"),a=[],o=function(t){if(0===(t=t.trim()).length||t.includes("Ctrl-C"))return"continue";if(i.a.isEmpty(n.columns))for(var e=t.split(/\s\s+/),r=0;r<e.length;r++){var o=t.indexOf(e[r]),s=r+1<e.length?t.indexOf(e[r+1])-1:void 0;n.columns.push({text:e[r]}),a.push([o,s])}else{var u=a.map(function(e){return t.substring(e[0],e[1]).trim()});n.rows.push(u)}},s=0,u=r;s<u.length;s++){o(u[s])}return[n]},t.prototype.transform=function(t,e){if(e.format===a.a.TimeSeries)return this.updateLabels(t,e);if(e.format===a.a.Heatmap)return this.transformToHeatmap(t);if(e.format==a.a.Table)return this.transformToTable(t);throw{message:"Invalid target format '"+e.format+"', possible options: "+a.a.TimeSeries+", "+a.a.Heatmap+", "+a.a.Table}},t}();e.a=o},11:function(t,e,n){"use strict";var r=n(2),i=n(1),a=n.n(i),o=function(){function t(t,e){this.context=t,this.oldestDataMs=e,this.store={}}return t.prototype.ingestCounterMetric=function(t,e,n){if(t.length>0){var r=t[t.length-1],i=r[1],a=r[2],o=(n-i)/1e3;t.push([(e.value-a)/o,n,e.value])}else t.push([void 0,n,e.value])},t.prototype.ingestMetric=function(t,e,n){var r=this.context.findMetricMetadata(e.name);if(r)for(var i=0,a=e.instances;i<a.length;i++){var o=a[i],s=t[o.instanceName];(!s||r.labels&&"output"===r.labels.metrictype)&&(s=t[o.instanceName]=[]),"counter"===r.sem?this.ingestCounterMetric(s,o,n):s.push([o.value,n])}else console.info("skipping ingestion of "+e.name+": metadata not available")},t.prototype.ingest=function(t){if(!a.a.isEmpty(t))for(var e=t.timestamp.s?1e3*t.timestamp.s+t.timestamp.us/1e3:1e3*t.timestamp,n=0,r=t.values;n<r.length;n++){var i=r[n];this.store[i.name]||(this.store[i.name]={}),this.ingestMetric(this.store[i.name],i,e)}},t.prototype.queryTimeSeries=function(t,e,n){for(var r=[],i=0,a=t;i<a.length;i++){var o=a[i];if(o in this.store)for(var s in this.store[o]){var u={target:"null"===s?o:s,datapoints:this.store[o][s].filter(function(t){return e<=t[1]&&t[1]<=n&&null!=t[0]})};r.push(u)}}return r},t.prototype.cleanExpiredMetrics=function(){var t=(new Date).getTime()-this.oldestDataMs;for(var e in this.store)for(var n in this.store[e])this.store[e][n]=this.store[e][n].filter(function(e){return e[1]>t})},t}(),s=function(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},u=function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},c=function(){function t(t,e,n){this.context=t,this.datastore=e,this.keepPollingMs=n,this.requestedMetrics={}}return t.prototype.poll=function(){return s(this,void 0,void 0,function(){var t,e;return u(this,function(n){switch(n.label){case 0:return 0==(t=Object.keys(this.requestedMetrics)).length?[2]:[4,this.context.fetch(t,!0)];case 1:return e=n.sent(),this.datastore.ingest(e),[2]}})})},t.prototype.ensurePolling=function(t){for(var e=(new Date).getTime(),n=0,r=t;n<r.length;n++){var i=r[n];if(!this.context.findMetricMetadata(i))throw{message:"Cannot find metric "+i+" on PMDA."};this.requestedMetrics[i]=e}},t.prototype.removeMetricsFromPolling=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];delete this.requestedMetrics[r]}},t.prototype.cleanupExpiredMetrics=function(){var t=(new Date).getTime()-this.keepPollingMs;this.requestedMetrics=a.a.pickBy(this.requestedMetrics,function(e){return e>t})},t}(),l=function(){function t(){this.endpoints={}}return t.prototype.generateId=function(t,e){return e||(e=""),t+"::"+e},t.prototype.find=function(t,e){var n=this.generateId(t,e);return this.endpoints[n]},t.prototype.create=function(t,e,n,i){var a=this.generateId(t,e),s=new r.a(t,e),u=new o(s,i),l=new c(s,u,n);return this.endpoints[a]={context:s,datastore:u,poller:l},this.endpoints[a]},t.prototype.list=function(){return Object.values(this.endpoints)},t}();e.a=l},130:function(t,e,n){"use strict";n.r(e);var r=n(1),i=n.n(r);var a,o=n(11),s=n(10),u=n(2),c=function(){return(c=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},l=function(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},f=function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},h=function(){function t(t,e,n,r,i){this.instanceSettings=t,this.name=t.name,this.url=t.url,this.q=e,this.backendSrv=n,this.templateSrv=r,this.variableSrv=i,this.withCredentials=t.withCredentials,this.headers={"Content-Type":"application/json"},"string"==typeof t.basicAuth&&t.basicAuth.length>0&&(this.headers.Authorization=t.basicAuth);this.container_name_filter=function(t){return!0},this.pollIntervalMs=t.jsonData.pollIntervalMs||1e3,this.keepPollingMs=t.jsonData.keepPollingMs||2e4,this.olderstDataMs=t.jsonData.olderstDataMs||3e5,u.a.datasourceRequest=this.doRequest.bind(this),this.endpointRegistry=new o.a,this.transformations=new s.a(this.templateSrv),this.pollIntervalMs>0&&setInterval(this.doPollAll.bind(this),this.pollIntervalMs)}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","variableSrv"],t.prototype.doPollAll=function(){for(var t=[],e=0,n=this.endpointRegistry.list();e<n.length;e++){var r=n[e];r.datastore.cleanExpiredMetrics(),r.poller.cleanupExpiredMetrics(),t.push(r.poller.poll())}return Promise.all(t)},t.prototype.buildQueryTargets=function(t){var e=this;return t.targets.filter(function(t){return"select metric"!==t.target}).map(function(n){var r=i.a.isUndefined(n.data)?null:n.data;("string"==typeof r&&""===r.trim()&&(r=null),null!==r)&&(null!==r.match(/("(\$.+?)")/g)&&r.match(/("(\$.+?)")/g).map(function(n){var i=e.templateSrv.replace(n,t.scopedVars,"json");i!==n&&(r=r.replace(n,i.substring(1,i.length-1)))}),r=JSON.parse(r));return{data:r,target:e.templateSrv.replace(n.target,t.scopedVars,"regex"),displayName:e.templateSrv.replace(n.displayName,t.scopedVars,"regex"),refId:n.refId,hide:n.hide,type:n.type}})},t.prototype.getVariables=function(){var t={};return this.variableSrv.variables?(this.variableSrv.variables.forEach(function(e){var n=e.current.value;("$__all"===n||i.a.isEqual(n,["$__all"]))&&(n=null===e.allValue?e.options.slice(1).map(function(t){return t.value}):e.allValue),t[e.name]={text:e.current.text,value:n}}),t):{}},t.prototype.getConfiguredEndpoint=function(){var t=this.getVariables();if("_proto"in t&&"_host"in t&&"_port"in t){var e=t._proto.value+"://"+t._host.value+":"+t._port.value;return"_container"in t&&(e+="::"+t._container.value),e}e=this.instanceSettings.url;return this.instanceSettings.jsonData.container&&(e+="::"+this.instanceSettings.jsonData.container),e},t.prototype.targetName=function(t,e,n,r){if(["bcc.runq.latency","bcc.disk.all.latency"].includes(r)){var i=t[e];return i.split&&i.split("-")[1]||i}var a=n.length<=1?r:r.substring(function(t){for(var e=t.concat().sort(),n=e[0],r=e[e.length-1],i=n.length,a=0;a<i&&n.charAt(a)===r.charAt(a);)a++;return a}(n.map(function(t){return t.target}))),o=t&&Object.values(t)[0],s=t&&Object.values(t).every(function(t){return t===o});return t[e]?n.length>1?s?a:a+" ("+t[e]+")":t[e]:a},t.prototype.doRequest=function(t){return l(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return e=c({},t,{withCredentials:this.withCredentials,headers:this.headers}),[4,this.backendSrv.datasourceRequest(e)];case 1:return[2,n.sent()]}})})},t.prototype.testDatasource=function(){return l(this,void 0,void 0,function(){var t;return f(this,function(e){switch(e.label){case 0:t=new u.a(this.url),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,t.createContext()];case 2:return e.sent(),[2,{status:"success",title:"Success",message:"Data source configured successfully. If you wish to override the PCP endpoint for specific dashboards, you can use the  _host, _port, _proto, (and optionally _container) variables."}];case 3:return e.sent(),[2,{status:"error",title:"Additional configuration required",message:"Could not connect to the specified url. To use this data source, please configure the _host, _port, _proto, (and optionally _container) dashboard variables."}];case 4:return[2]}})})},t.prototype.annotationQuery=function(t){return l(this,void 0,void 0,function(){return f(this,function(t){return[2,[]]})})},t.prototype.metricFindQuery=function(t){return l(this,void 0,void 0,function(){var e;return f(this,function(n){switch(n.label){case 0:return[4,this.findOrCreateEndpoint()];case 1:return e=n.sent(),"containers.name"!==t?[3,3]:[4,e.context.fetch(["containers.name"])];case 2:return[2,n.sent().values[0].instances.map(function(t){return t.value}).filter(this.container_name_filter).map(function(t){return{text:t,value:t}})];case 3:return[2,e.context.getAllMetricNames().filter(function(e){return!t||e.includes(t)}).map(function(t){return{text:t,value:t}})]}})})},t.prototype.findOrCreateEndpoint=function(){return l(this,void 0,void 0,function(){var t,e,n;return f(this,function(r){switch(r.label){case 0:return t=this.getVariables(),e=t.url&&t.url.value.length>0?t.url.value:this.url,(n=this.endpointRegistry.find(e))?[3,2]:[4,(n=this.endpointRegistry.create(e,null,this.keepPollingMs,this.olderstDataMs)).context.fetchMetricMetadata()];case 1:r.sent(),r.label=2;case 2:return[2,n]}})})},t.prototype.query=function(t){return l(this,void 0,void 0,function(){var e,n,r,i,a,o,s,u;return f(this,function(c){switch(c.label){case 0:if(0==(e=t).targets.length)return[2,{data:[]}];n=[],r=0,i=e.targets,c.label=1;case 1:return r<i.length?(a=i[r]).hide||!a.expr&&!a.target?[3,3]:(a.expr||(a.expr=a.target),a.format||"timeseries"!==a.type&&"timeserie"!==a.type||(a.format="time_series"),0===(o=a.expr.trim()).length?[3,3]:[4,this.findOrCreateEndpoint()]):[3,4];case 2:s=c.sent();try{s.poller.ensurePolling([o]),u=s.datastore.queryTimeSeries([o],t.range.from.valueOf(),t.range.to.valueOf()),n.push.apply(n,this.transformations.transform(u,a))}catch(t){throw t.refId=a.refId,t}c.label=3;case 3:return r++,[3,1];case 4:return[2,{data:n}]}})})},t}(),p=n(5),d=n(0),v=(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),m=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.formats=[],r.target.expr=r.target.expr||r.target.target||"",r.target.format=r.target.format||r.getDefaultFormat(),r.formats=[{text:"Time series",value:d.a.TimeSeries},{text:"Table",value:d.a.Table},{text:"Heatmap",value:d.a.Heatmap}],r}return v(e,t),e.prototype.getDefaultFormat=function(){return"table"===this.panelCtrl.panel.type?d.a.Table:"heatmap"===this.panelCtrl.panel.type?d.a.Heatmap:d.a.TimeSeries},e.prototype.getAllMetrics=function(t){return this.datasource.metricFindQuery(t||"")},e.prototype.refreshMetricData=function(){this.panelCtrl.refresh()},e.templateUrl="datasources/live/partials/query.editor.html",e}(p.QueryCtrl);n.d(e,"ConfigCtrl",function(){return y}),n.d(e,"QueryOptionsCtrl",function(){return g}),n.d(e,"AnnotationsQueryCtrl",function(){return b}),n.d(e,"Datasource",function(){return h}),n.d(e,"QueryCtrl",function(){return m});var y=function(){function t(){}return t.templateUrl="datasources/live/partials/config.html",t}(),g=function(){function t(){}return t.templateUrl="datasources/live/partials/query.options.html",t}(),b=function(){function t(){}return t.templateUrl="datasources/live/partials/annotations.editor.html",t}()},2:function(t,e,n){"use strict";var r=n(1),i=n.n(r),a=function(t,e,n,r){return new(n||(n=Promise))(function(i,a){function o(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},o=function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},s=function(){function t(t,e){this.url=t,this.container=e,this.contextPromise=null,this.metricMetadataCache={},this.indomCache={},this.d="",t.includes(":44322")||(this.d="_")}return t.prototype._createContext=function(){return a(this,void 0,void 0,function(){var e,n;return o(this,function(r){switch(r.label){case 0:return e=this.url+"/pmapi/context?hostspec=127.0.0.1&polltimeout=30",[4,t.datasourceRequest({url:e})];case 1:return n=r.sent(),this.context=n.data.context,this.container?[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"store",params:{name:"pmcd.client.container",value:this.container}})]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.createContext=function(){return a(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.contextPromise?[2,this.contextPromise]:(this.contextPromise=this._createContext(),[4,this.contextPromise]);case 1:return t.sent(),this.contextPromise=null,[2]}})})},t.prototype.ensureContext=function(t){return a(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return this.context?[3,2]:[4,this.createContext()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,9]),[4,t()];case 3:return[2,n.sent()];case 4:return e=n.sent(),i.a.isString(e.data)&&(e.data.includes("12376")||e.data.includes("unknown context identifier"))?(console.debug("context expired, creating new context..."),[4,this.createContext()]):[3,7];case 5:return n.sent(),[4,t()];case 6:return[2,n.sent()];case 7:throw e;case 8:return[3,9];case 9:return[2]}})})},t.prototype.fetchMetricMetadata=function(e){return a(this,void 0,void 0,function(){var n,r,i,s,u,c=this;return o(this,function(l){switch(l.label){case 0:return n={},e&&(n.prefix=e),[4,this.ensureContext(function(){return a(c,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"metric",params:n})];case 1:return[2,e.sent().data.metrics]}})})})];case 1:for(r=l.sent(),this.metricMetadataCache={},i=0,s=r;i<s.length;i++)u=s[i],this.metricMetadataCache[u.name]=u;return[2]}})})},t.prototype.findMetricMetadata=function(t){return this.metricMetadataCache[t]},t.prototype.getAllMetricNames=function(){return Object.keys(this.metricMetadataCache)},t.prototype.refreshIndoms=function(e){return a(this,void 0,void 0,function(){var n,r,i,s,u=this;return o(this,function(c){switch(c.label){case 0:return[4,this.ensureContext(function(){return a(u,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"indom",params:{name:e}})];case 1:return[2,n.sent().data.instances]}})})})];case 1:for(n=c.sent(),this.indomCache[e]={},r=0,i=n;r<i.length;r++)s=i[r],this.indomCache[e][s.instance]=s.name;return[2,this.indomCache[e]]}})})},t.prototype.fetch=function(e,n){return void 0===n&&(n=!1),a(this,void 0,void 0,function(){var r,i,s,u,c,l,f,h,p,d=this;return o(this,function(v){switch(v.label){case 0:return[4,this.ensureContext(function(){return a(d,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"fetch",params:{names:e.join(",")}})];case 1:return[2,n.sent().data]}})})})];case 1:if(r=v.sent(),!n)return[3,9];i=0,s=r.values,v.label=2;case 2:return i<s.length?0==(u=s[i]).instances.length?[3,8]:null===u.instances[0].instance||-1===u.instances[0].instance?(u.instances[0].instanceName=null,[3,8]):(c=this.indomCache[u.name])?[3,4]:[4,this.refreshIndoms(u.name)]:[3,9];case 3:c=v.sent(),v.label=4;case 4:l=!1,f=0,h=u.instances,v.label=5;case 5:return f<h.length?((p=h[f]).instanceName=c[p.instance],p.instanceName||l?[3,7]:[4,this.refreshIndoms(u.name)]):[3,8];case 6:c=v.sent(),p.instanceName=c[p.instance],l=!0,v.label=7;case 7:return f++,[3,5];case 8:return i++,[3,2];case 9:return[2,r]}})})},t.prototype.store=function(e,n){return a(this,void 0,void 0,function(){var r=this;return o(this,function(i){switch(i.label){case 0:return[4,this.ensureContext(function(){return t.datasourceRequest({url:r.url+"/pmapi/"+r.context+"/"+r.d+"store",params:{name:e,value:n}})})];case 1:return[2,i.sent()]}})})},t}();e.a=s},5:function(t,n){t.exports=e}})});
//# sourceMappingURL=module.js.map