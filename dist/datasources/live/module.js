define(["lodash","app/plugins/sdk"],function(t,e){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var a=e[r]={i:r,l:!1,exports:{}};return t[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=133)}({0:function(e,n){e.exports=t},1:function(t,e,n){"use strict";var r;n.d(e,"a",function(){return r}),function(t){t.TimeSeries="time_series",t.Table="table",t.Heatmap="heatmap"}(r||(r={}))},11:function(t,e,n){"use strict";var r=n(0),a=n.n(r),i=n(1),o=function(){function t(t){this.templateSrv=t}return t.prototype.getLabel=function(t,e){if(a.a.isEmpty(e))return t;var n=t.split("."),r={instance:{value:t},metric0:{value:n[n.length-1]}};return this.templateSrv.replace(e,r)},t.prototype.updateLabel=function(t,e){return{target:this.getLabel(e.target,t.legendFormat),datapoints:e.datapoints}},t.prototype.transformToTimeSeries=function(t,e){return a.a.flatten(t.map(function(t){return t.data})).map(this.updateLabel.bind(this,e))},t.prototype.transformToHeatmap=function(t){for(var e=t[0].data,n=0,r=e;n<r.length;n++){var a=r[n],i=a.target.match(/^(.+?)\-(.+?)$/);i&&(a.target=i[2]),a.datapoints=a.datapoints.map(function(t){return[t[0],1e3*Math.floor(t[1]/1e3)]})}return e},t.prototype.transformStringToTable=function(t){for(var e={columns:[],rows:[],type:"table"},n=t.split("\n"),r=[],i=function(t){if(0===(t=t.trim()).length||t.includes("Ctrl-C"))return"continue";if(a.a.isEmpty(e.columns))for(var n=t.split(/\s\s+/),i=0;i<n.length;i++){var o=t.indexOf(n[i]),s=i+1<n.length?t.indexOf(n[i+1])-1:void 0;e.columns.push({text:n[i]}),r.push([o,s])}else{var u=r.map(function(e){return t.substring(e[0],e[1]).trim()});e.rows.push(u)}},o=0,s=n;o<s.length;o++){i(s[o])}return e},t.prototype.transformMultipleMetricsToTable=function(t){var e={columns:[],rows:[],type:"table"};e.columns=t.map(function(t){return{text:t.metric}});for(var n=function(n){for(var r=[],a=0,i=t;a<i.length;a++){var o=i[a].data.find(function(t){return t.target===n});o&&o.datapoints.length>0?r.push(o.datapoints[o.datapoints.length-1][0]):r.push("?")}e.rows.push(r)},r=0,a=Object.keys(t[0].data).sort(function(t,e){return parseInt(t)-parseInt(e)});r<a.length;r++){n(a[r])}return e},t.prototype.transformToTable=function(t){if(t.length>1)return this.transformMultipleMetricsToTable(t);if(1===t.length){var e=t[0].data;if(e.length>0&&e[0].datapoints.length>0)return this.transformStringToTable(e[0].datapoints[0][0])}return{columns:[],rows:[],type:"table"}},t.prototype.transform=function(t,e){if(e.format===i.a.TimeSeries)return this.transformToTimeSeries(t,e);if(e.format===i.a.Heatmap)return this.transformToHeatmap(t);if(e.format==i.a.Table)return[this.transformToTable(t)];throw{message:"Invalid target format '"+e.format+"', possible options: "+i.a.TimeSeries+", "+i.a.Heatmap+", "+i.a.Table}},t}();e.a=o},12:function(t,e,n){"use strict";var r=n(2),a=n(0),i=n.n(a),o=function(){function t(t,e){this.context=t,this.oldestDataMs=e,this.store={}}return t.prototype.ingestCounterMetric=function(t,e,n){if(t.length>0){var r=t[t.length-1],a=r[1],i=r[2],o=(n-a)/1e3;t.push([(e.value-i)/o,n,e.value])}else t.push([void 0,n,e.value])},t.prototype.ingestMetric=function(t,e,n){var r=this.context.findMetricMetadata(e.name);if(r)for(var a=0,i=e.instances;a<i.length;a++){var o=i[a];o.instanceName in t&&(!r.labels||"output"!==r.labels.metrictype)||(t[o.instanceName]=[]),"counter"===r.sem?this.ingestCounterMetric(t[o.instanceName],o,n):t[o.instanceName].push([o.value,n])}else console.info("skipping ingestion of "+e.name+": metadata not available")},t.prototype.ingest=function(t){if(!i.a.isEmpty(t))for(var e=t.timestamp.s?1e3*t.timestamp.s+t.timestamp.us/1e3:1e3*t.timestamp,n=0,r=t.values;n<r.length;n++){var a=r[n];this.store[a.name]||(this.store[a.name]={}),this.ingestMetric(this.store[a.name],a,e)}},t.prototype.queryMetric=function(t,e,n){var r=[];for(var a in this.store[t]){var i={target:"null"===a?t:a,datapoints:this.store[t][a].filter(function(t){return e<=t[1]&&t[1]<=n&&null!=t[0]})};r.push(i)}return r},t.prototype.queryMetrics=function(t,e,n){var r=this;return t.map(function(t){return{metric:t,data:r.queryMetric(t,e,n)}})},t.prototype.cleanExpiredMetrics=function(){var t=(new Date).getTime()-this.oldestDataMs;for(var e in this.store)for(var n in this.store[e])this.store[e][n]=this.store[e][n].filter(function(e){return e[1]>t})},t}(),s=function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},u=function(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},c=function(){function t(t,e,n){this.context=t,this.datastore=e,this.keepPollingMs=n,this.requestedMetrics={}}return t.prototype.poll=function(){return s(this,void 0,void 0,function(){var t,e;return u(this,function(n){switch(n.label){case 0:return 0==(t=Object.keys(this.requestedMetrics)).length?[2]:[4,this.context.fetch(t,!0)];case 1:return e=n.sent(),this.datastore.ingest(e),[2]}})})},t.prototype.ensurePolling=function(t){for(var e=(new Date).getTime(),n=0,r=t;n<r.length;n++){var a=r[n];if(!this.context.findMetricMetadata(a))throw{message:"Cannot find metric "+a+" on PMDA."};this.requestedMetrics[a]=e}},t.prototype.removeMetricsFromPolling=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];delete this.requestedMetrics[r]}},t.prototype.cleanupExpiredMetrics=function(){var t=(new Date).getTime()-this.keepPollingMs;this.requestedMetrics=i.a.pickBy(this.requestedMetrics,function(e){return e>t})},t}(),l=function(){function t(){this.endpoints={}}return t.prototype.generateId=function(t,e){return e||(e=""),t+"::"+e},t.prototype.find=function(t,e){var n=this.generateId(t,e);return this.endpoints[n]},t.prototype.create=function(t,e,n,a){var i=this.generateId(t,e),s=new r.a(t,e),u=new o(s,a),l=new c(s,u,n);return this.endpoints[i]={context:s,datastore:u,poller:l},this.endpoints[i]},t.prototype.list=function(){return Object.values(this.endpoints)},t}();e.a=l},133:function(t,e,n){"use strict";n.r(e);var r,a=n(0),i=n.n(a),o=n(1),s=n(12),u=n(11),c=n(2),l=n(3),f=function(t,e,n,r){var a,i=arguments.length,o=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(o=(i<3?a(o):i>3?a(e,n,o):a(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},h=function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},p=function(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},d=function(){function t(t,e,n,r,a){this.instanceSettings=t,this.name=t.name,this.q=e,this.backendSrv=n,this.templateSrv=r,this.variableSrv=a,this.withCredentials=t.withCredentials,this.headers={"Content-Type":"application/json"},"string"==typeof t.basicAuth&&t.basicAuth.length>0&&(this.headers.Authorization=t.basicAuth),this.pollIntervalMs=t.jsonData.pollIntervalMs||1e3,this.keepPollingMs=t.jsonData.keepPollingMs||2e4,this.olderstDataMs=t.jsonData.olderstDataMs||3e5,c.a.datasourceRequest=this.doRequest.bind(this),this.endpointRegistry=new s.a,this.transformations=new u.a(this.templateSrv),this.pollIntervalMs>0&&setInterval(this.doPollAll.bind(this),this.pollIntervalMs);this.container_name_filter=function(t){return!0}}return t.$inject=["instanceSettings","$q","backendSrv","templateSrv","variableSrv"],t.prototype.doPollAll=function(){for(var t=[],e=0,n=this.endpointRegistry.list();e<n.length;e++){var r=n[e];r.datastore.cleanExpiredMetrics(),r.poller.cleanupExpiredMetrics(),t.push(r.poller.poll())}return Promise.all(t)},t.prototype.getOrCreateEndpoint=function(t){return void 0===t&&(t={}),h(this,void 0,void 0,function(){var e,n,r,a;return p(this,function(i){switch(i.label){case 0:return e=Object(l.a)(this.variableSrv,t,this.instanceSettings),n=e[0],r=e[1],(a=this.endpointRegistry.find(n,r))?[3,2]:[4,(a=this.endpointRegistry.create(n,r,this.keepPollingMs,this.olderstDataMs)).context.fetchMetricMetadata()];case 1:i.sent(),i.label=2;case 2:return[2,a]}})})},t.prototype.doRequest=function(t){return h(this,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return t.withCredentials=this.withCredentials,t.headers=this.headers,[4,this.backendSrv.datasourceRequest(t)];case 1:return[2,e.sent()]}})})},t.prototype.testDatasource=function(){return h(this,void 0,void 0,function(){var t,e,n,r;return p(this,function(a){switch(a.label){case 0:t=Object(l.a)(this.variableSrv,{},this.instanceSettings),e=t[0],n=t[1],r=new c.a(e,n),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,r.createContext()];case 2:return a.sent(),[2,{status:"success",message:"Data source is working",title:"Success"}];case 3:return a.sent(),[2,{status:"success",title:"Additional configuration required",message:"Could not connect to "+e+". To use this data source, please configure the url, and optionally the container dashboard variable(s)."}];case 4:return[2]}})})},t.prototype.metricFindQuery=function(t){return h(this,void 0,void 0,function(){var e;return p(this,function(n){switch(n.label){case 0:return[4,this.getOrCreateEndpoint()];case 1:return e=n.sent(),"containers.name"!==t?[3,3]:[4,e.context.fetch(["containers.name"])];case 2:return[2,n.sent().values[0].instances.map(function(t){return t.value}).filter(this.container_name_filter).map(function(t){return{text:t,value:t}})];case 3:return[2]}})})},t.prototype.query=function(t){return h(this,void 0,void 0,function(){var e,n,r,a,s,u,c,l;return p(this,function(f){switch(f.label){case 0:e=[],n=0,r=t.targets,f.label=1;case 1:return n<r.length?(a=r[n]).hide||!a.expr&&!a.target?[3,3]:(a.expr||(a.expr=a.target),a.format||"timeseries"!==a.type&&"timeserie"!==a.type||(a.format="time_series"),0===(s=a.expr.trim()).length?[3,3]:[4,this.getOrCreateEndpoint(a)]):[3,4];case 2:u=f.sent();try{if(c=[],a.format===o.a.Table){if(!i.a.every(t.targets,["format",o.a.Table]))throw{message:"To use the table format, every query of this panel has to be in table format"};c=t.targets.map(function(t){return t.expr})}else c=[s];if(u.poller.ensurePolling(c),l=u.datastore.queryMetrics(c,t.range.from.valueOf(),t.range.to.valueOf()),e.push.apply(e,this.transformations.transform(l,a)),a.format===o.a.Table)return[3,4]}catch(t){throw t.refId=a.refId,t}f.label=3;case 3:return n++,[3,1];case 4:return[2,{data:e}]}})})},f([l.b],t.prototype,"getOrCreateEndpoint",null),t}(),m=n(6),v=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),y=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.formats=[],r.target.expr=r.target.expr||r.target.target||"",r.target.format=r.target.format||r.getDefaultFormat(),r.formats=[{text:"Time series",value:o.a.TimeSeries},{text:"Table",value:o.a.Table},{text:"Heatmap",value:o.a.Heatmap}],r}return v(e,t),e.prototype.getDefaultFormat=function(){return"table"===this.panelCtrl.panel.type?o.a.Table:"heatmap"===this.panelCtrl.panel.type?o.a.Heatmap:o.a.TimeSeries},e.prototype.getAllMetrics=function(t){return this.datasource.metricFindQuery(t||"")},e.prototype.refreshMetricData=function(){this.panelCtrl.refresh()},e.templateUrl="datasources/live/partials/query.editor.html",e}(m.QueryCtrl);n.d(e,"ConfigCtrl",function(){return b}),n.d(e,"QueryOptionsCtrl",function(){return g}),n.d(e,"AnnotationsQueryCtrl",function(){return w}),n.d(e,"Datasource",function(){return d}),n.d(e,"QueryCtrl",function(){return y});var b=function(){function t(){}return t.templateUrl="datasources/live/partials/config.html",t}(),g=function(){function t(){}return t.templateUrl="datasources/live/partials/query.options.html",t}(),w=function(){function t(){}return t.templateUrl="datasources/live/partials/annotations.editor.html",t}()},2:function(t,e,n){"use strict";var r=n(0),a=n.n(r),i=n(3),o=function(t,e,n,r){var a,i=arguments.length,o=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(o=(i<3?a(o):i>3?a(e,n,o):a(e,n))||o);return i>3&&o&&Object.defineProperty(e,n,o),o},s=function(t,e,n,r){return new(n||(n=Promise))(function(a,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function s(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(o,s)}u((r=r.apply(t,e||[])).next())})},u=function(t,e){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},c=function(){function t(t,e){this.url=t,this.container=e,this.metricMetadataCache={},this.indomCache={},this.d="",t.includes(":44322")||(this.d="_")}return t.prototype.createContext=function(){return s(this,void 0,void 0,function(){var e,n;return u(this,function(r){switch(r.label){case 0:return e=this.url+"/pmapi/context?hostspec=127.0.0.1&polltimeout=30",[4,t.datasourceRequest({url:e})];case 1:return n=r.sent(),this.context=n.data.context,this.container?[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"store",params:{name:"pmcd.client.container",value:this.container}})]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.ensureContext=function(t){return s(this,void 0,void 0,function(){var e;return u(this,function(n){switch(n.label){case 0:return this.context?[3,2]:[4,this.createContext()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,9]),[4,t()];case 3:return[2,n.sent()];case 4:return e=n.sent(),a.a.isString(e.data)&&e.data.includes("12376")||a.a.isObject(e.data)&&e.data.message.includes("unknown context identifier")?(console.debug("context expired, creating new context..."),[4,this.createContext()]):[3,7];case 5:return n.sent(),[4,t()];case 6:return[2,n.sent()];case 7:throw e;case 8:return[3,9];case 9:return[2]}})})},t.prototype.fetchMetricMetadata=function(e){return s(this,void 0,void 0,function(){var n,r,a,i,o,c=this;return u(this,function(l){switch(l.label){case 0:return n={},e&&(n.prefix=e),[4,this.ensureContext(function(){return s(c,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:return[4,t.datasourceRequest({url:"http://localhost:44322/pmapi/metric",params:n})];case 1:return[2,e.sent().data.metrics]}})})})];case 1:for(r=l.sent(),this.metricMetadataCache={},a=0,i=r;a<i.length;a++)o=i[a],this.metricMetadataCache[o.name]=o;return[2]}})})},t.prototype.findMetricMetadata=function(t){return this.metricMetadataCache[t]},t.prototype.getAllMetricNames=function(){return Object.keys(this.metricMetadataCache)},t.prototype.refreshIndoms=function(e){return s(this,void 0,void 0,function(){var n,r,a,i,o=this;return u(this,function(c){switch(c.label){case 0:return[4,this.ensureContext(function(){return s(o,void 0,void 0,function(){return u(this,function(n){switch(n.label){case 0:return[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"indom",params:{name:e}})];case 1:return[2,n.sent().data.instances]}})})})];case 1:for(n=c.sent(),this.indomCache[e]={},r=0,a=n;r<a.length;r++)i=a[r],this.indomCache[e][i.instance]=i.name;return[2,this.indomCache[e]]}})})},t.prototype.fetch=function(e,n){return void 0===n&&(n=!1),s(this,void 0,void 0,function(){var r,a,i,o,c,l,f,h,p,d=this;return u(this,function(m){switch(m.label){case 0:return[4,this.ensureContext(function(){return s(d,void 0,void 0,function(){return u(this,function(n){switch(n.label){case 0:return[4,t.datasourceRequest({url:this.url+"/pmapi/"+this.context+"/"+this.d+"fetch",params:{names:e.join(",")}})];case 1:return[2,n.sent().data]}})})})];case 1:if(r=m.sent(),!n)return[3,9];a=0,i=r.values,m.label=2;case 2:return a<i.length?0==(o=i[a]).instances.length?[3,8]:null===o.instances[0].instance||-1===o.instances[0].instance?(o.instances[0].instanceName=null,[3,8]):(c=this.indomCache[o.name])?[3,4]:[4,this.refreshIndoms(o.name)]:[3,9];case 3:c=m.sent(),m.label=4;case 4:l=!1,f=0,h=o.instances,m.label=5;case 5:return f<h.length?((p=h[f]).instanceName=c[p.instance],p.instanceName||l?[3,7]:[4,this.refreshIndoms(o.name)]):[3,8];case 6:c=m.sent(),p.instanceName=c[p.instance],l=!0,m.label=7;case 7:return f++,[3,5];case 8:return a++,[3,2];case 9:return[2,r]}})})},t.prototype.store=function(e,n){return s(this,void 0,void 0,function(){var r=this;return u(this,function(a){switch(a.label){case 0:return[4,this.ensureContext(function(){return t.datasourceRequest({url:r.url+"/pmapi/"+r.context+"/"+r.d+"store",params:{name:e,value:n}})})];case 1:return[2,a.sent()]}})})},o([i.b],t.prototype,"createContext",null),t}();e.a=c},3:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return s});var r=n(0),a=n.n(r);function i(t,e,n){var r=n.value;n.value=function(){var t=this;return this.inflightCalls||(this.inflightCalls={}),this.inflightCalls[e]?this.inflightCalls[e]:(this.inflightCalls[e]=r.apply(this,arguments),this.inflightCalls[e].then(function(n){return t.inflightCalls[e]=null,n}))}}function o(t){return!t||0===t.trim().length}function s(t,e,n){if(!o(e.url))return[e.url,e.container];var r=function(t){var e={};return t.variables?(t.variables.forEach(function(t){var n=t.current.value;("$__all"===n||a.a.isEqual(n,["$__all"]))&&(n=null===t.allValue?t.options.slice(1).map(function(t){return t.value}):t.allValue),e[t.name]={text:t.current.text,value:n}}),e):{}}(t);if(!o(r.url))return[r.url,r.container];if(!o(n.url))return[n.url,n.jsonData.container];throw{message:"Cannot find any connection parameters."}}},6:function(t,n){t.exports=e}})});
//# sourceMappingURL=module.js.map